
# [Day15] 狀態機的撰寫

## 什麼是狀態機呢？
狀態機，其實是`有限狀態機(finite-state machine(FSM))`的簡稱，字面上來看可以知道它是有**有限**個狀態，並且可以按照著特定的順序來完成各個狀態內的動作，這使數位電路也能按著想要的順序完成特定的動作，例如某種演算法、某種傳輸協定等等。

---

## 狀態的編碼方式
常見的編碼有以下三種：
- 二進制編碼
- Gray code(格雷码)
- One Hot

---

## 三種編碼方式各自的優缺點
### 二進制編碼
優點：
- 可使用較少bit數的register來跑狀態，n個狀態只需要log2(n)個bit的register，在狀態很多時能有效節省register數量，有助於面積的減小。
- 編碼規則較簡單，採用數字遞增的方式來編碼即可。

缺點：
- 會綜合出較多的組合邏輯。
- 在狀態與狀態之間轉跳時，因為有多bit同時變化的情況發生，如此一來容易在次態的生成邏輯上產生glitch(毛刺)。
- 加上輸出與狀態有關，又二進制編碼複雜的關係造成，容易成為整體電路的critical path。

### Gray code(格雷碼)
優點：
- 一樣與二進制編碼相同，可使用較少bit數(log2(n) bit)的register來跑狀態。
- 格雷碼的特點是，上一個數字與下一個數字之間只差1bit的變化，可以改善二進制編碼中glitch的問題。

缺點：
- 雖然可以改善二進制編碼的缺點，但前提是狀態的變化是`依照順序的`，否則就失去這優勢了，但實際上幾乎不可能狀態都按著順序跳，所以這的編碼方法幾乎與二進制編碼效果差不多。
### One Hot
EX:
```
//One-Hot
localparam IDLE  = 4'b0001;
localparam START = 4'b0010;
localparam SHIFT = 4'b0100;
localparam STOP  = 4'b1000;
```
優點：
- 狀態與狀態之間的變化最少1bit而最多只會有2bit的變化。
- 因為bit變化少，組合邏輯資源也會相對較少。

缺點：
- 跑狀態的register需要花費較多的bit數，若n個狀態則要n個bit的register。

**下面來實際看一下二進制編碼與one-hot合成出電路的差異~**
`binary`


`one-hot`
![](https://i.imgur.com/8oVoHQx.png)

